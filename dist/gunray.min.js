(function(){(function(Y,c){var q,C,n,l,r,L,D,M,N,x,s,E,p,t,O,P,Q,y,R,h,m,z,A,u,v,B,w,F,S,T,U,G,H,V,I,J,W,X;C={};G=function(a){return""+a};h=function(a){return c.isUndefined(a)||c.isNull(a)};t=function(a){return function(){return a.create.apply(new a,arguments)}};v=function(a){return function(b){return!h(b)&&b.__type__===a}};s=function(a,b){if(!a)throw b;};l=function(){};l.create=function(){var a,b,e;a=[];e=c.first(arguments);b=function(b){switch(!1){case !c.isFunction(b):return a.push(b),function(){return c.remove(a,
function(a){return a===b})};case !h(b):return e;default:return e=b,c.each(a,function(a){return a(e)}),e}};c.extend(b,{__type__:l});return b};w=t(l);u=v(l);E=function(a,b){return function(){var a,d;d=c.first(arguments);a=[];switch(!1){case !c.isFunction(d):b.push({event:"all",callback:d});a.push(c.last(b));break;case !c.isObject(d):c.each(d,function(d,f){var g;g=f.split(":");f=g[0];b.push({event:f,callback:d,property:g[1]});return a.push(c.last(b))})}return function(){return c.remove(b,function(b){return c.include(a,
b)})}}};H=function(a,b){return function(a,d,k,f){c.each(c.clone(b),function(b){if(b.event===d||"all"===b.event){if(h(b.property))return b.callback(a,d);if(!h(a.prop(b.property)))return b.callback(a.get(b.property),a,d,f)}});return V.apply(this,arguments)}};V=function(){if(Q(self))return self.collection().trigger.apply(this,arguments)};Q=function(){return A(self)&&c.isFunction(self.collection)&&m(self.collection())};n=function(){};n.create=function(){var a,b,e,d,k;a=c.first(arguments);e=c.reduce(a,
function(a,b,d){switch(!1){case !c.isFunction(b):null;break;case !c.isArray(b):a[d]=p(b);break;case !c.isObject(b):b=B(b);a[d]=b;break;default:a[d]=w(),a[d](b)}return a},{});d=function(a){return c.reduce(a.split("."),function(a,b){var d;switch(!1){case !(d=b.match(/^at\((\d)\)$/)):return s(m(a),"Tried to use index access on a non-collection"),a.at(c.last(d));case !c.isFunction(a.prop):return a.prop(b);case !c.isObject(a):return a[b];default:return a}},e)};b=[];a=E(this,b);k=H(this,b);c.extend(this,
{__type__:n,__data__:e,__bindings__:b,get:function(a){return d(a)()},set:function(a,b){var e,p=this;e=function(a,b){var c,e;e=d(a);c=e();if(c!==b)return e(b),k(p,"update",b,c)};switch(!1){case !c.isString(a):return e(a,b);case !c.isObject(a):return c.each(a,function(a,b){return e(b,a)})}},trigger:k,prop:d,bind:a});return this};B=t(n);A=v(n);q=function(){};q.create=function(){var a,b,e,d,k,f,g,K,h,m,n,l;a=c.first(arguments);s(c.isArray(a),"Invalid Argument");k=w(this);K=function(a){var b;b=function(){switch(!1){case !A(a):return a;
case !z(a):return a;case !c.isObject(a):return B(a);case !c.isArray(a):return p(a);default:return w(a)}}();b.collection=k;return b};d=c.map(a,function(a){return K(a)});f=c.first(c.rest(arguments))||{};e=f.bindings||[];a=E(this,e);l=H(this,e);f=f.iterator||k;g=function(){return d.length};n=function(a){var c;c=b(a);d.splice(a,1);return l(c,"remove",c,null)};b=function(a){return c.first(c.at(d,a))};h=function(a){return p(c.map(d,a),{bindings:e,iterator:a})};m=function(a,b){return p(c.reduce(d,b,a))};
c.extend(this,{__type__:q,__data__:d,__bindings__:e,at:b,add:function(a){a=K(a);d.push(a);return l(a,"add",a,null)},remove:function(a){return n(c.indexOf(d,a))},removeAt:n,bind:a,iterator:f,trigger:l,first:function(){return c.first(d)},rest:function(){return c.rest(d)},last:function(){return c.last(d)},length:g,count:g,size:g,each:function(a){return p(c.each(d,a))},map:h,mapHtml:function(a){return h(function(b){return y(a(b),{item:b})})},inject:m,reduce:m});return this};p=t(q);m=v(q);S=function(a,
b){return function(){return a.removeChild(b)}};F=function(a,b){return function(){return a.slice(c.indexOf(a,b),1)}};M=function(a,b,c){var d;d=document.createTextNode(function(){switch(!1){case !u(b):return b(function(a){return d.data=G(a)}),b();default:return G(b)}}());F(a,d);return a.appendChild(d)};L=function(a,b,c){b=y(b);return D.call(this,a,b,c)};D=function(a,b,c){var d,k,f;this.children.push(b);k=S(a,b.dom);d=F(this.children,b);h(c)||(f=c.bind({remove:function(a){if(a===b.__context__)return k(),
d(),f()}}));return a.appendChild(b.dom)};x=function(a,b,e){var d=this;return c.each(b,function(b){var f;switch(!1){case !z(b):return D.call(d,a,b,e);case !m(b):return f=function(c){return function(e){return x.call(d,a,[c(e)],b)}},b.bind({add:f(b.iterator)}),b.each(f(function(a){return a}));case !h(b):return null;case !(c.isArray(b)&&c.isArray(c.first(b))):return x.call(d,a,b);case !(c.isArray(b)&&c.isString(c.first(b))):return L.call(d,a,b,e);default:return M(a,b,e)}})};U=/([^\s\.\#]+)(?:\#([^\s\.\#]+))?(?:\.([^\s\#]+))?/;
T=function(a){var b,c;b=a.match(U);a=b[1];c=b[2];b=b[3];return[a,c,b?b.split("."):void 0]};O="click focus blur dblclick change mousedown mousemove mouseout mouseover mouseup resize scroll select submit load unload".split(" ");X=function(a){return function(b){return J(a,b)}};J=function(a,b){return a.className=b.join(" ")};W=function(a,b){return function(c){return I(a,b,c)}};I=function(a,b,c){var d;switch(b){case "checked":return(d=!!c)?a.setAttribute(b,c):a.removeAttribute(b),a.checked=d;default:return a.setAttribute(b,
c)}};N=function(a,b,e,d){b&&(d.id=b);e&&(d.classes=e);if(b=d["class"])d.classes||(d.classes=[]),d.classes.push(b);return c.each(d,function(b,d){switch(!1){case "classes"!==d:return J(a,u(b)?(b(X(a)),b()):b);case "style"!==d:return c.each(b,function(b,c){return a.style.setProperty(c,b)});case !c.include(O,d):return b(a);default:return I(a,d,u(b)?(b(W(a,d)),b()):b)}})};P=function(a){var b;b=c.rest(a);a=c.first(b);return R(a)?[a,c.rest(b)]:[{},b]};R=function(a){return c.isObject(a)&&!c.isArray(a)&&!c.isFunction(a)&&
!m(a)};r=function(){};r.create=function(a,b){var e,d,k,f,g,h;b=b||{};s(c.isArray(a),"Invalid Template");g=c.first(a);s(c.isString(g),"Invalid Template");e=T(g);g=e[0];k=e[1];d=e[2];f=P(a);e=f[0];h=f[1];f=b.item;g=document.createElement(g);c.extend(this,{__type__:r,__context__:f,dom:g,children:[]});N.call(this,g,k,d,e);x.call(this,g,h);return this};y=t(r);z=v(r);c.extend(C,{isProperty:u,isObject:A,isCollection:m,isHtml:z,html:y,property:w,object:B,collection:p});return Y.Gunray=C})(this,_)}).call(this);
